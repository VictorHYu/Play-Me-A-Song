<!doctype html>
<script src='./webaudiox-master/build/webaudiox.js'></script>
<script src='./analyzer.js'></script>

<body style='margin: 0; overflow: hidden; background-color: #444444'>

<script>
    var context	= new AudioContext()
    
    // Create lineOut
    var lineOut	= new WebAudiox.LineOut(context)
    lineOut.volume	= 0.2
    
    var analyser	= context.createAnalyser()
    analyser.connect(lineOut.destination);
    lineOut.destination	= analyser;
    
    // load a sound and play it immediatly
    WebAudiox.loadBuffer(context, './A Sky Full of Stars.mp3', function(buffer){
        var source	= context.createBufferSource();
        source.buffer	= buffer;
        source.loop	= true
        source.connect(lineOut.destination);
        source.start(0);
        });

        // create and add the canvas
        var canvas	= document.createElement('canvas');
        canvas.width	= window.innerWidth;
        canvas.height	= window.innerHeight;
        var ctx		= canvas.getContext("2d");  
        document.body.appendChild(canvas)

        // create the object
        var analyser2canvas	= new WebAudiox.Analyser2Canvas(analyser, canvas)

        // loop and update
        requestAnimationFrame(function update() {
                           requestAnimationFrame(update);
                           // clear the canvas
                           ctx.clearRect(0, 0, canvas.width, canvas.height);
                           // put the sound in the canvas
                           analyser2canvas.update()
                           })                           
</script></body>

